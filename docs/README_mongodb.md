# üêò –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ MongoDB

## `setup_mongodb.sh` - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MongoDB —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–µ—Ä—Å–∏–π, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

## ‚ú® –§—É–Ω–∫—Ü–∏–∏

- üéØ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏**: –≤—ã–±–æ—Ä —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π –≤–µ—Ä—Å–∏–∏ MongoDB –¥–ª—è –≤–∞—à–µ–π Ubuntu
- üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø–∞—Ä–æ–ª–µ–π
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –∏ –¥–≤–∏–∂–∫–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- üîÑ **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ replica sets –∏ config servers
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MongoDB Exporter –¥–ª—è Prometheus
- üíæ **–ë—ç–∫–∞–ø—ã**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- üìã **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
curl -fsSL https://raw.githubusercontent.com/Muhendalf-ru/vps-script/main/setup_mongodb.sh -o setup_mongodb.sh && chmod +x setup_mongodb.sh && sudo ./setup_mongodb.sh
```

---

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏)

```bash
./setup_mongodb.sh
```

### MongoDB 5.0 –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É

```bash
./setup_mongodb.sh -v 5.0 -p 27018
```

### –° –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –ª–∏–º–∏—Ç–æ–º –ø–∞–º—è—Ç–∏

```bash
./setup_mongodb.sh -a -m 2048
```

### Config server –¥–ª—è replica set

```bash
./setup_mongodb.sh -r -c
```

### In-memory —Å –±—ç–∫–∞–ø–∞–º–∏

```bash
./setup_mongodb.sh -b -s inMemory
```

### –¢–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞

```bash
./setup_mongodb.sh -n
```

### –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥

```bash
./setup_mongodb.sh -v -a
```

---

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏

| –û–ø—Ü–∏—è                  | –û–ø–∏—Å–∞–Ω–∏–µ                                              |
| ---------------------- | ----------------------------------------------------- |
| `-v, --version`        | –í–µ—Ä—Å–∏—è MongoDB (4.4, 5.0, 6.0, 7.0) [–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ] |
| `-p, --port`           | –ü–æ—Ä—Ç MongoDB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 27017)                    |
| `-d, --data-dir`       | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –¥–∞–Ω–Ω—ã—Ö                                 |
| `-l, --log-dir`        | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤                                  |
| `-u, --user`           | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å MongoDB                                  |
| `-a, --auth`           | –í–∫–ª—é—á–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é                               |
| `-r, --replica-set`    | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∫ —á–∞—Å—Ç—å replica set                       |
| `-c, --config-server`  | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∫ config server                           |
| `-m, --memory`         | –õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –≤ MB                                     |
| `-s, --storage-engine` | –î–≤–∏–∂–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è (wiredTiger, inMemory)                |
| `-b, --backup`         | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã                       |
| `-n, --no-start`       | –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å MongoDB –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏                  |
| `--verbose`            | –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥                                       |
| `-h, --help`           | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É                                      |

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–ª–∞–≥–∞ `-a` —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å (32 –±–∞–π—Ç–∞ base64)
- –°–æ–∑–¥–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –í—ã–¥–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π:

```
üêò MongoDB —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!

üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:
   –í–µ—Ä—Å–∏—è: 6.0.12
   –ü–æ—Ä—Ç: 27017
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: admin
   –ü–∞—Ä–æ–ª—å: xK9mP2nQ8vR5tY7wZ1aB3cD6eF9gH2jK
   –î–∞–Ω–Ω—ã–µ: /var/lib/mongodb
   –õ–æ–≥–∏: /var/log/mongodb

üîó –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
   mongodb://admin:xK9mP2nQ8vR5tY7wZ1aB3cD6eF9gH2jK@localhost:27017/admin

üìù –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
   –°—Ç–∞—Ç—É—Å: sudo systemctl status mongod
   –ó–∞–ø—É—Å–∫: sudo systemctl start mongod
   –û—Å—Ç–∞–Ω–æ–≤–∫–∞: sudo systemctl stop mongod
   –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫: sudo systemctl restart mongod

üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
   MongoDB Exporter: http://localhost:9216/metrics
   Prometheus endpoint: /metrics
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±—ç–∫–∞–ø—ã

### MongoDB Exporter

- **–ü–æ—Ä—Ç**: 9216
- **–ú–µ—Ç—Ä–∏–∫–∏**: –¥–ª—è Prometheus
- **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫**: –≤–∫–ª—é—á–µ–Ω
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00
- **–†–æ—Ç–∞—Ü–∏—è**: 7 –¥–Ω–µ–π
- **–°–∂–∞—Ç–∏–µ**: –≤–∫–ª—é—á–µ–Ω–æ
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ø–æ email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–§–æ—Ä–º–∞—Ç**: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
- **–†–æ—Ç–∞—Ü–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è
- **–£—Ä–æ–≤–µ–Ω—å**: INFO
- **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

---

## üìã –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### üéØ –ì–∏–±–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π MongoDB —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ä—Å–∏–∏.

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–≤–∏–∂–∫–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### üîÑ –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ replica sets
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è config servers
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ê–ª–µ—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –î–∞—à–±–æ—Ä–¥—ã Grafana

### üíæ –ë—ç–∫–∞–ø—ã

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã
- –†–æ—Ç–∞—Ü–∏—è –∏ —Å–∂–∞—Ç–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤

---

## üîÑ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º—É—é –≤–µ—Ä—Å–∏—é MongoDB –¥–ª—è –≤–∞—à–µ–π –≤–µ—Ä—Å–∏–∏ Ubuntu:

| Ubuntu Version | –ö–æ–¥–æ–≤–æ–µ –∏–º—è | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–µ—Ä—Å–∏–∏ MongoDB | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è |
| -------------- | ----------- | ----------------------------- | ------------- |
| 24.04+         | noble       | 7.0+                          | 7.0           |
| 22.04+         | jammy       | 6.0+, 7.0                     | 6.0           |
| 20.04+         | focal       | 5.0+, 6.0, 7.0                | 5.0           |
| 18.04+         | bionic      | 4.4+, 5.0, 6.0, 7.0           | 4.4           |

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –≤–∞—à–µ–π Ubuntu, —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—É—é –≤–µ—Ä—Å–∏—é:

```bash
[INFO] –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ Ubuntu 24.04 (noble)
[WARNING] Ubuntu 24.04 (noble) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç MongoDB 7.0+
[WARNING] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ MongoDB 7.0
[INFO] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ MongoDB 7.0 –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
```

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å

- –ì–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üîÑ Replica Set

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ replica set

```bash
# –ü–µ—Ä–≤–∏—á–Ω—ã–π —É–∑–µ–ª
./setup_mongodb.sh -r -p 27017

# –í—Ç–æ—Ä–∏—á–Ω—ã–π —É–∑–µ–ª 1
./setup_mongodb.sh -r -p 27018

# –í—Ç–æ—Ä–∏—á–Ω—ã–π —É–∑–µ–ª 2
./setup_mongodb.sh -r -p 27019
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è replica set

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É —É–∑–ª—É
mongosh --port 27017

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ replica set
rs.initiate({
  _id: "rs0",
  members: [
    { _id: 0, host: "localhost:27017" },
    { _id: 1, host: "localhost:27018" },
    { _id: 2, host: "localhost:27019" }
  ]
})
```

---

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–û–°**: Ubuntu 20.04 –∏–ª–∏ –Ω–æ–≤–µ–µ
- **–ü—Ä–∞–≤–∞**: root (sudo)
- **–ü–∞–º—è—Ç—å**: –º–∏–Ω–∏–º—É–º 512MB RAM
- **–î–∏—Å–∫**: –º–∏–Ω–∏–º—É–º 1GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: x86_64, ARM64

---

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: MongoDB –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status mongod

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u mongod -f

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la /var/lib/mongodb/
ls -la /var/log/mongodb/
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç
sudo netstat -tlnp | grep 27017

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª
sudo ufw status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo cat /etc/mongod.conf
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h

# –£–º–µ–Ω—å—à–∏—Ç–µ –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏
sudo systemctl stop mongod
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ /etc/mongod.conf
sudo systemctl start mongod
```

---

## üìù –õ–æ–≥–∏

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤:

- `/var/log/mongodb_setup_YYYYMMDD_HHMMSS.log`
- `/var/log/mongodb/mongod.log`

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:

```bash
curl -fsSL https://raw.githubusercontent.com/Muhendalf-ru/vps-script/main/setup_mongodb.sh -o setup_mongodb.sh
chmod +x setup_mongodb.sh
```

---

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

### üê≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Snap

```bash
# –°–∫–∞—á–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
curl -fsSL https://raw.githubusercontent.com/Muhendalf-ru/vps-script/main/setup_mongodb_alternative.sh -o setup_mongodb_alternative.sh
chmod +x setup_mongodb_alternative.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB 7.0 —á–µ—Ä–µ–∑ Snap
sudo ./setup_mongodb_alternative.sh -v 7.0 -m snap
```

### üê≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Docker

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB 7.0 —á–µ—Ä–µ–∑ Docker
sudo ./setup_mongodb_alternative.sh -v 7.0 -m docker
```

### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB 7.0 —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
sudo ./setup_mongodb_alternative.sh -v 7.0 -m repo
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

| –ú–µ—Ç–æ–¥      | –û–ø–∏—Å–∞–Ω–∏–µ                | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞                 | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏                    |
| ---------- | ----------------------- | ---------------------------- | ----------------------------- |
| **repo**   | –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π | –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π | –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã—Ö –û–° |
| **snap**   | Snap –ø–∞–∫–µ—Ç              | –ü—Ä–æ—Å—Ç–æ—Ç–∞, –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è     | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞        |
| **docker** | Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä        | –ò–∑–æ–ª—è—Ü–∏—è, –≥–∏–±–∫–æ—Å—Ç—å           | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã        |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –°–∫–∞—á–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
curl -fsSL https://raw.githubusercontent.com/Muhendalf-ru/vps-script/main/test_mongodb_7.sh -o test_mongodb_7.sh
chmod +x test_mongodb_7.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
sudo ./test_mongodb_7.sh
```

### –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
curl -fsSL https://raw.githubusercontent.com/Muhendalf-ru/vps-script/main/debug_mongodb_repo.sh -o debug_mongodb_repo.sh
chmod +x debug_mongodb_repo.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
sudo ./debug_mongodb_repo.sh
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–µ—Å—Ç—ã:

#### test_mongodb_7.sh

- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GPG –∫–ª—é—á–µ–π MongoDB 6.0 –∏ 7.0
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π Ubuntu
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ MongoDB —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ

#### debug_mongodb_repo.sh

- ‚úÖ –í–µ—Ä—Å–∏—è Ubuntu –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GPG –∫–ª—é—á–µ–π (—Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π URL)
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- ‚úÖ DNS –∏ HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB 7.0
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
[INFO] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Ubuntu...
–í–µ—Ä—Å–∏—è: 24.04
–ö–æ–¥–æ–≤–æ–µ –∏–º—è: noble
[SUCCESS] –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
[SUCCESS] GPG –∫–ª—é—á MongoDB 7.0 –¥–æ—Å—Ç—É–ø–µ–Ω
[SUCCESS] MongoDB —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞–π–¥–µ–Ω –≤ apt update
[SUCCESS] –ü–∞–∫–µ—Ç mongodb-org –¥–æ—Å—Ç—É–ø–µ–Ω
mongodb-org/jammy/mongodb-org/7.0 7.0.21 amd64
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

- **[setup_mongodb.sh](README_mongodb.md)** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –≤–µ—Ä—Å–∏–∏
- **[setup_mongodb_alternative.sh](README_mongodb_alternative.md)** - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ MongoDB
- **[test_mongodb_7.sh](README_mongodb_test.md)** - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MongoDB —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- **[debug_mongodb_repo.sh](README_mongodb_debug.md)** - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ MongoDB
- **[security_audit.sh](README_security_audit.md)** - –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- **[start.sh](README_start.md)** - –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Issues**: [GitHub Issues](https://github.com/Muhendalf-ru/vps-script/issues)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [–ì–ª–∞–≤–Ω—ã–π README](../README.md)
- **–ê–≤—Ç–æ—Ä**: Pesherkino VPN

---

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 12.07.2025
